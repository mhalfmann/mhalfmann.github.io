<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>    
</head>
<body onload="iwmstudy_access.addInitFunction(init)">
	<script src="../../../../app/iwm_studyaddon.js"></script>
	<div id="iwmstudy_masterbox"><div id="iwmstudy_centerbox">	
		
		<!-- Inhalt -->
		<div id="iwmstudy_contentbox">
			<div id="instr" style="width: 100%; height: 10%; text-align: left;">Darstellung der virtuellen Umgebung wird überprüft - bitte warten (Gesamtdauer: 30 Sekunden) </div>
			<div class="webgl-content" style="width: 75%; height: 85%;">
				<div id="gameContainer" style="width: 100%; height: 100%;"></div>				
			</div>
		</div>

	</div></div>
	<script>
		var unityInstance
		var to
		
		function init(){
			to = setTimeout(abort,30000)
			unityInstance = UnityLoader.instantiate("gameContainer", "Build/FischeTest.json", {onProgress: UnityProgress})
			iwmstudy_access.addFinalizeFunction(finish)
		}

		function abort(){
			iwmstudy_access.linkto("abort")
		}

		function OnAppReady(){
			console.log("vr application has been loaded")
			clearTimeout(to)			
			unityInstance.SendMessage('control', 'setName', iwmstudy_access.getStudyinfo().user)			
			let condid = iwmstudy_access.getStudyinfo().conditionid
			//0 = Fisch bewegen, 1 = Kamera bewegen, 2 = keine Interaktion			
			let mode = 0
			if(condid == "camcontr"){
				mode = 1
			}
			else if(condid == "nointerac"){
				mode = 2
			}					
			unityInstance.SendMessage('control', 'setMode', mode)
			instr.innerHTML = "Überprüfung erfolgreich. Sie können jetzt die virtuelle Umgebung ausprobieren, indem Sie auf Starten klicken.<br>Nachdem Sie die virtuelle Umgebung ausprobiert haben, klicken Sie bitte auf den weiter-Button."						
		}

		function OnAppRunning(){
			console.log("scene has been loaded")			
			iwmstudy_access.logAction("vrtestsceneloaded",{})			
			iwmstudy_access.enableNextButton()			  
    	}

		function OnAppEnd(){
			console.log("vr application has finished")			
		}

		function finish(){
			unityInstance.SendMessage('control', 'logEnd')
		}
	</script>
</body>