<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>
<body onload="iwmstudy_access.addInitFunction(initDragNDrop)"></body>
	<script src="../../../app/iwm_studyaddon.js"></script>
	<div id="iwmstudy_masterbox"><div id="iwmstudy_centerbox">

		<!-- Ãœberschrift -->
		<div id="iwmstudy_headlinebox">Fragen: Drag & Drop (im Aufbau)</div>

		<!-- Inhalt -->
		<div id="iwmstudy_contentbox">

			<div class="iwmstudy_question_dragndrop" id="store_dnd1" data-itemwidth="60" data-itemheight="200">
				<span>Bitte bringen Sie die Zahlen in eine aufsteigende Reihenfolge</span><br/><br/>				
				<div id="dndrepository" style="display: inline-block; width:30%; height:80%; background-color:lightgray; border:2px solid grey;"></div>
				
				<div style="font-family: Webdings; display: inline-block; width: 10%; vertical-align: top; margin-top: 15%; text-align: center; font-size: 600%;">4</div>
				
				<div id="dndtargetbox" style="display: inline-block; width:50%; height:80%; background-color:lightgray; border:2px solid grey; ">
					<div class="dndtarget" id="target1" style="width:40%; height:10%; background-color:lightgray; border:2px solid grey; margin-top: 1%;"></div>
					<div class="dndtarget" id="target2" style="width:40%; height:10%; background-color:lightgray; border:2px solid grey; margin-top: 1%;"></div>
					<div class="dndtarget" id="target3" style="width:40%; height:10%; background-color:lightgray; border:2px solid grey; margin-top: 1%;"></div>
				</div>
				<div class="dnditem" id="item1" style="background-color: blue; outline:2px solid grey; width: 250px; height: 50px; top: 200px;" draggable="false"> </div>
				<div class="dnditem" id="item2" style="background-color: red; outline:2px solid grey; width: 250px; height: 50px; top: 400px;" draggable="false"> </div>
			</div>
			            
		</div>

    </div></div>    
    <script>
		class DnDItem {
			constructor(id, element) {
				this.id = id				
				this.element = element
				this.startx
				this.starty				
				//console.log(dndrepository.style.height)
			}

			setStartPos(){
				this.startx = this.element.style.left
				this.starty = this.element.style.top
			}	

			moveToStartPos(){
				this.element.style.left = this.startx
				this.element.style.top = this.starty
			}		
		}

		class DnDRepository {
			constructor(element){				
				this.containsitemids = []
				this.element = element
			}
		}

		class DnDTarget {
			constructor(id, element){
				this.id = id
				this.containsitemid = null
				this.element = element
			}
		}

        class DragNDropController {
				constructor() {					
					this.topzindex = 10000					
					this.mouseisdown = false					
					this.dnditems = new Map()
					for(let it of document.getElementsByClassName("dnditem")){
						this.dnditems.set(it.id,new DnDItem(it.id, it))
						it.addEventListener('touchstart', this.startinteraction.bind(this), false)
						it.addEventListener('touchmove', this.moveinteraction.bind(this), false)
						it.addEventListener('touchend', this.endinteraction.bind(this), false)
						it.addEventListener('mousedown', this.startinteraction.bind(this), false)
						it.addEventListener('mousemove', this.moveinteraction.bind(this), false)
						it.addEventListener('mouseup', this.endinteraction.bind(this), false)
					}
					this.dndtargets = new Map()
					for(let ta of document.getElementsByClassName("dndtarget")){
						this.dndtargets.set(ta.id,new DnDTarget(ta.id, ta))
					}
					this.dndrepository = new DnDRepository(document.getElementById("dndrepository"))
				}

				shuffle(array) {
					var currentIndex = array.length, temporaryValue, randomIndex
					// While there remain elements to shuffle...
					while (0 !== currentIndex) {
						// Pick a remaining element...
						randomIndex = Math.floor(Math.random() * currentIndex)
						currentIndex -= 1
						// And swap it with the current element.
						temporaryValue = array[currentIndex]
						array[currentIndex] = array[randomIndex]
						array[randomIndex] = temporaryValue
					}
					return array
				}

				startinteraction(e) {
					e.preventDefault()
					this.mouseisdown = true
					this.topzindex++
					let mte = e
					if (e.type == "touchstart") {
						mte = e.touches[0]
					}
					let it = this.dnditems.get(e.target.id)
					it.setStartPos()
					it.element.style.zIndex = this.topzindex
					// if (this.resultslot1 == e.target.id) {
					// 	this.resultslot1 = null
					// }
					// else if (this.resultslot2 == e.target.id) {
					// 	this.resultslot2 = null
					// }
					// else if (this.resultslot3 == e.target.id) {
					// 	this.resultslot3 = null
					// }
				}

				moveinteraction(e) {
					let mte = e
					if (e.type == "touchmove") {
						mte = e.touches[0]
					}
					if (this.mouseisdown) {
						let it = this.dnditems.get(e.target.id)
						let itwidth = it.element.style.width.split("p")[0]
						let itheight = it.element.style.height.split("p")[0]
						it.element.style.left = (mte.clientX - itwidth/2) + "px"	
						it.element.style.top = (mte.clientY - itheight/2) + "px"					
					}
				}

				isDropAllowed(it){					
					console.log(it.element.getBoundingClientRect().x + window.pageXOffset)
					console.log(target1.getBoundingClientRect().x + window.pageXOffset)
					return false
				}

				endinteraction(e) {
					let mte = e
					if (e.type == "touchend") {
						mte = e.touches[0]
					}
					this.mouseisdown = false	
					let it = this.dnditems.get(e.target.id)
					if(this.isDropAllowed(it)){

					}
					else{
						it.moveToStartPos()
					}



					// let endposx = this[e.target.id + "cx"] + e.target.offsetLeft
					// let endposy = this[e.target.id + "cy"] + e.target.offsetTop
					// let computedleft = null
					// let computedtop = null
					// if (endposx >= 205 && endposx <= 355) {
					// 	computedleft = 280
					// }
					// else if (endposx >= 1125 && endposx <= 1275) {
					// 	computedleft = 1200
					// }
					// if (endposy >= 45 && endposy <= 195) {
					// 	computedtop = 120
					// 	if (computedleft == 1200) {
					// 		if (this.resultslot1 == null) {
					// 			this.resultslot1 = e.target.id
					// 		}
					// 		else {
					// 			computedleft = 740;
					// 			computedtop = 410;
					// 		}
					// 	}
					// }
					// else if (endposy >= 335 && endposy <= 485) {
					// 	computedtop = 410
					// 	if (computedleft == 1200) {
					// 		if (this.resultslot2 == null) {
					// 			this.resultslot2 = e.currentTarget.id
					// 		}
					// 		else {
					// 			computedleft = 740;
					// 			computedtop = 410;
					// 		}
					// 	}
					// }
					// else if (endposy >= 625 && endposy <= 775) {
					// 	computedtop = 700
					// 	if (computedleft == 1200) {
					// 		if (this.resultslot3 == null) {
					// 			this.resultslot3 = e.currentTarget.id
					// 		}
					// 		else {
					// 			computedleft = 740;
					// 			computedtop = 410;
					// 		}
					// 	}
					// }
					// if (computedleft != null && computedtop != null) {
					// 	this.moveItemTo(e.currentTarget, computedleft, computedtop)
					// }
					// else {
					// 	//this.checkfinished()
					// }
				}

				moveItemTo(item, x, y) {
					item.style.webkitTransform = 'translate3d(' + (x - item.offsetLeft) + 'px,' + (y - item.offsetTop) + 'px,0)';
					window[item.id + "cx"] = x - item.offsetLeft;
					window[item.id + "cy"] = y - item.offsetTop;

				}
			}

			function initDragNDrop() {
				window.dndcontroller01 = new DragNDropController()
			}
	</script>	
</body>