<!doctype HTML>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">
<script src="./assets/text.js"></script>
<script src="./assets/images.js"></script>
<script src="./javascript/utility.js"></script>
<script src="./javascript/variables.js"></script>
<!-- <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"> -->
<!-- <script src="./Javascript/aframe.min.js"></script> -->
<!-- <script src="./Javascript/aframe-ar.js"></script> -->
<!-- <script src="../../../Javascript/hammer.js"></script> -->
<script src="../../Javascript/TweenMax.min.js"></script>
<script src="../../Javascript/jquery-3.6.0.min.js"></script>
<!-- <script src="../../../Javascript/jquery.csv.js"></script> -->
<!-- <script src="../../../Javascript/papaparse.min.js"></script> -->
<link rel="stylesheet" type="text/css" href="./css/style.css">
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
<style>

</style>
  <body version="0.1.5" onselectstart = 'return false' style='margin : 0px; overflow: hidden; background:  rgb(82, 82, 82); font-family: "Open Sans";'>    
  <div id="main">

    <div id="goLeft" class="button" style ="left: 5px; top: 47vh; height: 6vh; width:6vh">
      <img id="leftArrow" src="../../Assets/Icons/arrow-back.png" width="100%">
    </div>
    <div id="goRight" class="button" style ="right: 5px; top: 47vh; height: 6vh; width:6vh;">
      <img id="rightArrow" src="../../Assets/Icons/arrow-forward.png" width="100%">
    </div>
    
    <ul id = "imageBar" style ="list-style: none; position: absolute; right: 10%; top: 10%; height: 80%; width: 80%;overflow-y: hidden;">
    </ul>

    <div id="infoCard">
      <div id="infoImage" > 
        <img id="infoImageIMG" onload="loaded(this)">
      </div>
      <div id="infoText">
        <div id="infoTextTXT"></div>
      </div>
      <div id = "closeInfoCard">
        <img src="../../Assets/Icons/close.png" height="100%">
      </div>
    </div>
    <div class="button" onclick="changeLang(this)" lang="DE" style="right: 5%; bottom: 5%;">
      DE
    </div>
    <div id="output" style="opacity: 0; position: absolute; left: 55%; bottom: 5%; background: rgb(63, 63, 63); padding: 10px; color:white; border-radius: 5px;">
      Output
    </div>
    
  </div>
  <div id="overlay">
    <div id="overlayText">      
      Bitte Leertaste dr√ºcken
    </div>
  </div>
  </body>
  <script>
    console.log("Version: "+document.body.getAttribute('version'))

    let iCard = document.getElementById("infoCard")
    let iImage = document.getElementById("infoImageIMG")
    let iText = document.getElementById("infoTextTXT")
    let imgBar = document.getElementById("imageBar")

    let right = false
    let left = false

    let infoTextString = ""

    let screenHeight = window.innerHeight
    let screenWidth = window.innerWidth
    let imgBarHeight = imgBar.getBoundingClientRect().height
    let imgBarWidth = imgBar.getBoundingClientRect().width

    let maxImgHeight = 0
    let maxImgWidth = 0

    let currentThumbnail = 0

    let thumbnailArray = []
    // changeOrientation();

    // console.log(sessionStorage.getItem("start"))
    // sessionStorage.setItem("start", "true")

    language = "DE"

    function changeLang(target){
      switch(target.getAttribute('lang')){
        case "DE":
          target.innerHTML = "EN"
          target.setAttribute('lang','EN')
          language = "EN"
          if(iCard.style.visibility=="visible")document.getElementById("infoTextTXT").innerHTML = document.getElementById(iCard.getAttribute('imgID')).getAttribute('textEN')
          break;
        case "EN":
          target.innerHTML = "DE"
          target.setAttribute('lang','DE')
          language = "DE"
          if(iCard.style.visibility=="visible")document.getElementById("infoTextTXT").innerHTML = document.getElementById(iCard.getAttribute('imgID')).getAttribute('textDE')
          break;
      }
    }
    // document.getElementById("header").innerHTML = Gm338.text
    // console.log(screenWidth+" x "+screenHeight)

    for(var i=0; i<images.length; i++){
        if(images[i].height>maxImgHeight) maxImgHeight = images[i].height
        if(images[i].width>maxImgWidth) maxImgWidth = images[i].width
    }

    addImages()

    for(var i=1; i<thumbnailArray.length; i++){
      // console.log(thumbnailArray[i].id)
      
      thumbnailArray[i].style.pointerEvents = "none"
      
      TweenMax.to(thumbnailArray[i], 0, {"clipPath":"inset(0% 100% 0% 0%)",transformOrigin:"right"})
      // TweenMax.to(thumbnailArray[i], 0, {x:500, opacity:0, onComplete:function(){
          
      // }})
    }
    function addImages(){
    
      for(var i=0; i<images.length; i++){
        // let img = imageArray[i]
        let img = images[i]
        infoTextString = ""

        let thumbnailFrame = document.createElement('li')
        thumbnailFrame.className ="thumbnailFrame"
        document.getElementById("imageBar").appendChild(thumbnailFrame)

        let thumbnail = document.createElement('img')

        thumbnail.className ="thumbnail"
        thumbnail.src = img.file
        thumbnail.id = img.id
        thumbnail.style.position = "absolute"

        thumbnail.style.marginRight = "5vw"
        if(img.id.toString().indexOf("Gm1079")>-1){
          thumbnail.style.marginRight = "1vw"
        }
        if(img.id.toString().indexOf("Gm1079R")>-1){
          thumbnail.style.marginRight = "5vw"
        }

        let f = imgBarHeight/maxImgHeight

        thumbnail.style.width = f*img.width+"px"
        thumbnail.style.height = f*img.height+"px"
        
        let top = (imgBarHeight - f*img.height)/2
        let left = (imgBarWidth - f*img.width)/2

        thumbnail.style.top = top+"px"
        thumbnail.style.left = left+"px"

        thumbnailFrame.appendChild(thumbnail)

        thumbnailArray.push(thumbnail)

        thumbnail.addEventListener('load',(e)=>{
          addText(e.target)
        })

        thumbnail.addEventListener('click',(e)=>{
          iImage.src = e.target.src
          iCard.setAttribute('imgID', e.target.id)
          if(language == "DE")document.getElementById("infoTextTXT").innerHTML = e.target.getAttribute('textDE')
          if(language == "EN")document.getElementById("infoTextTXT").innerHTML = e.target.getAttribute('textEN')

          console.log(e.target.id)
        })
      }
    }

    function loaded(img){

      let imgOuterWidth = document.getElementById("infoImage").getBoundingClientRect().width
      let imgOuterHeight = document.getElementById("infoImage").getBoundingClientRect().height
      let textOuterWidth = document.getElementById("infoText").getBoundingClientRect().width
      let textOuterHeight = document.getElementById("infoText").getBoundingClientRect().height
      
      let imgInnerWidth = document.getElementById("infoImageIMG").getBoundingClientRect().width
      let imgInnerHeight = document.getElementById("infoImageIMG").getBoundingClientRect().height
      let textInnerWidth = document.getElementById("infoTextTXT").getBoundingClientRect().width
      let textInnerHeight = document.getElementById("infoTextTXT").getBoundingClientRect().height
      // let cardWidth = imgWidth+textWidth      

      let imgPosX = (imgOuterWidth-imgInnerWidth)/2
      let imgPosY = (imgOuterHeight-imgInnerHeight)/2
      let txtPosY = (textOuterHeight-textInnerHeight)/2

      // console.log(imgOuterWidth,imgInnerWidth,imgPosX)

      // let left = (screenWidth-cardWidth)/2

      // iCard.style.width = cardWidth+"px"
      // iCard.style.height = imgHeight+"px"
      // iCard.style.left = left+"px"
      // iCard.style.left = "15%"
      iImage.style.left = imgPosX+"px"
      iImage.style.top = imgPosY+"px"
      iText.style.top = txtPosY+"px"

      iCard.style.visibility = "visible"
    }

    document.addEventListener('keydown', function(event) {
      console.log("key down "+event.keyCode)
      if(event.keyCode == 37) {
        $('#imageBar').animate({
            scrollLeft: $('#imageBar').scrollLeft()-20
        }, 0)
      }
      if(event.keyCode == 39) {
        $('#imageBar').animate({
            scrollLeft: $('#imageBar').scrollLeft()+20
        }, 0)
      }
      if(event.keyCode == 32) {
        overlay.style.visibility = "hidden"
      }
    })

    document.getElementById("goRight").addEventListener('click',(e)=>{  
      
      currentThumbnail--
      goLeft.style.opacity = 1
      if(currentThumbnail==0)goRight.style.opacity = 0.1
      if(currentThumbnail<0)currentThumbnail = 0
      
      thumbnailArray[currentThumbnail+1].style.pointerEvents = "none"
      thumbnailArray[currentThumbnail].style.pointerEvents = "all"

      TweenMax.to(thumbnailArray[currentThumbnail+1], 0.5, {x:500, onComplete:function(){
          
      }})
      // TweenMax.to(thumbnailArray[currentThumbnail+1], 0.5, {opacity:0, onComplete:function(){
          
      // }})
      TweenMax.to(thumbnailArray[currentThumbnail], 0.5, {x:0, onComplete:function(){
          
      }})
      // TweenMax.to(thumbnailArray[currentThumbnail], 0.2, {opacity:1, onComplete:function(){
          
      // }})

      if(iCard.style.visibility=="visible"){
        iImage.src = thumbnailArray[currentThumbnail].src        
        if(language == "DE")document.getElementById("infoTextTXT").innerHTML = thumbnailArray[currentThumbnail].getAttribute('textDE')
        if(language == "EN")document.getElementById("infoTextTXT").innerHTML = thumbnailArray[currentThumbnail].getAttribute('textEN')
      }
        
    })

    document.getElementById("goLeft").addEventListener('click',(e)=>{
      
      currentThumbnail++
      
      // let h = thumbnailArray[currentThumbnail].getBoundingClientRect().height
      // let h_1 = thumbnailArray[currentThumbnail-1].getBoundingClientRect().height
      goRight.style.opacity = 1
      if(currentThumbnail==thumbnailArray.length-1)goLeft.style.opacity = 0.1
      if(currentThumbnail>thumbnailArray.length-1)currentThumbnail = thumbnailArray.length-1

      thumbnailArray[currentThumbnail-1].style.pointerEvents = "none"
      thumbnailArray[currentThumbnail].style.pointerEvents = "all"

      // thumbnailArray[currentThumbnail].style.clip = "rect(0px, 50px, "+h+"px, 0px)"
      // thumbnailArray[currentThumbnail].style.clipPath="inset(0% 90% 0% 0%)"

      TweenMax.to(thumbnailArray[currentThumbnail-1], 1.5, {"clipPath":"inset(0% 100% 0% 0%)",transformOrigin:"right"})
      TweenMax.to(thumbnailArray[currentThumbnail], 1.5, {"clipPath":"inset(0% 0% 0% 0%)",transformOrigin:"bottom"})
      // TweenMax.to(thumbnailArray[currentThumbnail-1], 0.5, {"clip":"rect(0px, 10px, 100px, 0px)",transformOrigin:"right"})
      // TweenMax.to(thumbnailArray[currentThumbnail-1], 0.5, {"scale":0.1,transformOrigin:"right"})
      // TweenMax.to(thumbnailArray[currentThumbnail-1], 0.5, {opacity:0, onComplete:function(){
          
      // }})
      // TweenMax.to(thumbnailArray[currentThumbnail], 0.5, {x:0, onComplete:function(){
          
      // }})
      // TweenMax.to(thumbnailArray[currentThumbnail], 0.2, {opacity:1, onComplete:function(){
          
      // }})

      if(iCard.style.visibility=="visible"){
        iImage.src = thumbnailArray[currentThumbnail].src        
        if(language == "DE")document.getElementById("infoTextTXT").innerHTML = thumbnailArray[currentThumbnail].getAttribute('textDE')
        if(language == "EN")document.getElementById("infoTextTXT").innerHTML = thumbnailArray[currentThumbnail].getAttribute('textEN')
      }

    }) 

    document.getElementById("closeInfoCard").addEventListener('click',()=>{
      iCard.style.visibility = "hidden"
    })
    window.addEventListener("orientationchange", function() {
      // changeOrientation()
    }, false)
  </script>
</html>