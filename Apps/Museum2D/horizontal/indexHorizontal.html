<!doctype HTML>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="../assets/images.js"></script>
<script src="../assets/text.js"></script>
<!-- <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"> -->
<!-- <script src="./Javascript/aframe.min.js"></script> -->
<!-- <script src="./Javascript/aframe-ar.js"></script> -->
<script src="../../../Javascript/hammer.js"></script>
<script src="../../../Javascript/TweenMax.min.js"></script>
<script src="../../../Javascript/jquery-3.6.0.min.js"></script>
<!-- <script src="../../../Javascript/jquery.csv.js"></script> -->
<script src="../../../Javascript/papaparse.min.js"></script>
<link rel="stylesheet" type="text/css" href="../../../css/ui.css">
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
<style>
  a, a:visited { 
      text-decoration: none; 
      color: white;
      }
    
  .uiButtonFrame{
  }
  .thumbnail{
    /* max-height: 200px; */
    /* max-width: 200px; */
    width: 100px;
    height: auto;
    padding: 10px;
  }
  .thumbnailFrame{
    height: 80%;
    width: 2%;
    background: rgb(253, 99, 99);
    padding: 10px;
    align-items: center;
    display: flex;
  }
  .uiDialogueElement{
    margin: 10px;
  }
  
  #imageBar::-webkit-scrollbar {
    display: none;
  }

  #imageBar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

</style>
  <body version="0.0.10" onload="addImages()" onselectstart = 'return false' style='margin : 0px; overflow: hidden; background:  rgb(82, 82, 82); font-family: "Open Sans";'>    
   <!--  <div id ="header" style="position: absolute; left: 0px; top: 0%;height: 50px; width:100%; background: rgb(24, 24, 24); text-align: center; color: white; font-size: 35px; margin-bottom: 50px;">
      Museum 2D
    </div> -->
  <div id="main" style ="position: absolute; left: 0px; top: 0px;height: 100%; width:100%; overflow: hidden; padding-top: 5vh; background: rgb(116, 126, 138);">

    <div id="goLeft" style ="position: absolute; left: 5px; top: 47vh; height: 6vh; width:6vh; background: rgb(63, 63, 63); border-radius: 5px;">
      <img id="leftArrow" src="../../../Assets/Icons/arrow-back.png" width="100%">
    </div>
    <div id="goRight" style ="position: absolute; right: 5px; top: 47vh; height: 6vh; width:6vh; background: rgb(63,63,63); border-radius: 5px;">
      <img id="rightArrow" src="../../../Assets/Icons/arrow-forward.png" width="100%">
    </div>
    
    <ul id = "imageBar" style ="list-style: none; position: absolute; right: 10%; top: 10%; height: 80%; width:80%; display: flex; overflow-y: hidden; overflow-x: auto;">
    </ul>

    <!-- <div id="infoCard" style ="position: absolute; left: 5%; top: 5%; height: 90%; width:70%; background: rgb(80, 86, 93); visibility: hidden; box-shadow: 5px 5px 10px 5px rgb(0, 0, 0)">
          <div id="infoImage" style="position: absolute; height: 80vh; max-width: 60vw; padding: 2vh;"> 
        <img id="infoImageIMG" onload="loaded(this)" style = "max-height: 100%; max-width: 90%;">
      </div>
      <div id="infoText" style="position: absolute; right: 0%; top: 0%; padding: 2vh; height: 80vh; width: 25vw; color: white">
        
      </div>
      <div id = "closeInfoCard" style ="position: absolute; right: 0%; bottom: 0%; margin: 2vh; height: 5vh; width:5vh;">
        <img src="../../../Assets/Icons/close.png" width="100%">
      </div>
    </div> -->

    <div id="infoCard" style ="position: absolute; left: 15%; top: 5%; height: 90%; width:70%; background: rgb(80, 86, 93); visibility: hidden; box-shadow: 5px 5px 10px 5px rgb(0, 0, 0)">
      <div id="infoImage" style="position: absolute; height: 100%; width: 70%;"> 
        <img id="infoImageIMG" onload="loaded(this)" style = "position: absolute; max-height: 90%; max-width: 90%;">
      </div>
      <div id="infoText" style="position: absolute; right: 0%; top: 0%; height: 95%; width: 30%; color: white;">
        <div id="infoTextTXT" style = "position: absolute; max-height: 100%; max-width: 100%; padding-right:5%;"></div>
      </div>
      <div id = "closeInfoCard" style ="position: absolute; right: 0%; bottom: 0%; margin: 0%; height: 5%;">
        <img src="../../../Assets/Icons/close.png" height="100%">
      </div>
    </div>
    <div onclick="changeLang(this)" lang="DE" style="position: absolute; left: 5%; bottom: 5%; background: rgb(63, 63, 63); padding: 10px; color:white; border-radius: 5px;">
      DE
    </div>
    
  </div>
  </body>
  <script>
    console.log("Version: "+document.body.getAttribute('version'))

    language = "DE"

    function changeLang(target){
      console.log("changing Language",target.innerHTML)
      switch(target.getAttribute('lang')){
        case "DE":
          target.innerHTML = "EN"
          target.setAttribute('lang','EN')
          language = "EN"
          document.getElementById("infoTextTXT").innerHTML = document.getElementById(iCard.getAttribute('imgID')).getAttribute('textEN')
          break;
        case "EN":
          target.innerHTML = "DE"
          target.setAttribute('lang','DE')
          language = "DE"
          document.getElementById("infoTextTXT").innerHTML = document.getElementById(iCard.getAttribute('imgID')).getAttribute('textDE')
          break;
      }
    }
   /*  var data
    $.ajax({
      type: "GET",  
      url: "../assets/Beschriftung.csv",
      dataType: "text",       
      success: function(response)  
      {
      data = $.csv.toArrays(response)
      console.log(data)
      }   
    }) */
   /*  var data;

    Papa.parse('../assets/Beschriftung.csv', {
      header: true,
      download: true,
      dynamicTyping: true,
      complete: function(results) {
        // console.log(results);
        data = results.data;
        console.log("data[1]",data[1]["Text deutsch"])
        // addImages()
      }
    }) */

    let iCard = document.getElementById("infoCard")
    let iImage = document.getElementById("infoImageIMG")
    let iText = document.getElementById("infoTextTXT")
    let imgBar = document.getElementById("imageBar")

    let right = false
    let left = false

    let infoTextString = ""

    let screenHeight = window.innerHeight
    let screenWidth = window.innerWidth
    let imgBarHeight = imgBar.getBoundingClientRect().height

    // document.getElementById("header").innerHTML = Gm338.text
    // console.log(screenWidth+" x "+screenHeight)
    // console.log(images[1].file)
    // console.log(text[1].Überschrift_deutsch)

    // addImages()
    let maxImgHeight = 0
    let maxImgWidth = 0

    for(var i=0; i<images.length; i++){
        if(images[i].height>maxImgHeight) maxImgHeight = images[i].height
        if(images[i].width>maxImgWidth) maxImgWidth = images[i].width
    }
    // console.log("maxImgHeight",maxImgHeight)
    // console.log("maxImgWidth",maxImgWidth)

    function addImages(){
    
      for(var i=0; i<images.length; i++){
        // let img = imageArray[i]
        let img = images[i]
        infoTextString = ""

        let thumbnailFrame = document.createElement('li')
        thumbnailFrame.className ="thumbailFrame"
        document.getElementById("imageBar").appendChild(thumbnailFrame)

        let thumbnail = document.createElement('img')

        thumbnail.className ="thumbnail"
        thumbnail.src = img.file
        thumbnail.id = img.id
        if(img.id.toString().indexOf("Gm1079")==-1){
          thumbnail.style.marginRight = "2vw"
          thumbnail.style.marginLeft = "2vw"
        }
        iCard.setAttribute('imgID',img.id)

        let f = imgBarHeight/maxImgHeight

        thumbnail.style.width = f*img.width+"px"
        thumbnail.style.height = f*img.height+"px"
        thumbnailFrame.appendChild(thumbnail)

        for(var j=0; j<text.length; j++){
          if(text[j].Inventarnummern!=null){  
                      
              if( text[j].Inventarnummern.toString().indexOf(thumbnail.id)>-1){

                let header = text[j].Überschrift_deutsch.toString().split('\n')

                for(var k=0; k<header.length; k++){
                  if(k==0)infoTextString+="<b>"+header[k]+"</b>"
                  if(k!=0)infoTextString+=header[k]
                  infoTextString+="<br>"                  
                }                
                infoTextString+="<br><br>"
                infoTextString+=text[j].Text_deutsch.toString()
                thumbnail.setAttribute('textDE',infoTextString)
              }
          }
          infoTextString = ""
          if(text[j].Inventarnummern!=null){  
                      
              if( text[j].Inventarnummern.toString().indexOf(thumbnail.id)>-1){

                let header = text[j].Überschrift_englisch.toString().split('\n')

                for(var k=0; k<header.length; k++){
                  if(k==0)infoTextString+="<b>"+header[k]+"</b>"
                  if(k!=0)infoTextString+=header[k]
                  infoTextString+="<br>"                  
                }                
                infoTextString+="<br><br>"
                infoTextString+=text[j].Text_englisch.toString()
                thumbnail.setAttribute('textEN',infoTextString)
              }
          }
        }

        let top = (imgBarHeight - f*img.height)/2
        thumbnail.style.marginTop = top+"px"

        thumbnail.addEventListener('click',(e)=>{
          iImage.src = e.target.src
          if(language == "DE")document.getElementById("infoTextTXT").innerHTML = e.target.getAttribute('textDE')
          if(language == "EN")document.getElementById("infoTextTXT").innerHTML = e.target.getAttribute('textEN')

          console.log(e.target.id)
        })
      }
    }

    function loaded(img){

      let imgOuterWidth = document.getElementById("infoImage").getBoundingClientRect().width
      let imgOuterHeight = document.getElementById("infoImage").getBoundingClientRect().height
      let textOuterWidth = document.getElementById("infoText").getBoundingClientRect().width
      let textOuterHeight = document.getElementById("infoText").getBoundingClientRect().height
      
      let imgInnerWidth = document.getElementById("infoImageIMG").getBoundingClientRect().width
      let imgInnerHeight = document.getElementById("infoImageIMG").getBoundingClientRect().height
      let textInnerWidth = document.getElementById("infoTextTXT").getBoundingClientRect().width
      let textInnerHeight = document.getElementById("infoTextTXT").getBoundingClientRect().height
      // let cardWidth = imgWidth+textWidth      

      let imgPosX = (imgOuterWidth-imgInnerWidth)/2
      let imgPosY = (imgOuterHeight-imgInnerHeight)/2
      let txtPosY = (textOuterHeight-textInnerHeight)/2

      // console.log(imgOuterWidth,imgInnerWidth,imgPosX)

      // let left = (screenWidth-cardWidth)/2

      // iCard.style.width = cardWidth+"px"
      // iCard.style.height = imgHeight+"px"
      // iCard.style.left = left+"px"
      // iCard.style.left = "15%"
      iImage.style.left = imgPosX+"px"
      iImage.style.top = imgPosY+"px"
      iText.style.top = txtPosY+"px"

      iCard.style.visibility = "visible"
    }

    document.addEventListener('keydown', function(event) {
        if(event.keyCode == 37) {
          $('#imageBar').animate({
              scrollLeft: $('#imageBar').scrollLeft()-10
          }, 0)
        }
        else if(event.keyCode == 39) {
          $('#imageBar').animate({
              scrollLeft: $('#imageBar').scrollLeft()+10
          }, 0)
        }
    })
/*let mousedownID = -1;  //Global ID of mouse down interval
  function mousedown(event) {
    if(mousedownID==-1)  //Prevent multimple loops!
      mousedownID = setInterval(whilemousedown, 100 );
  }
  function mouseup(event) {
    if(mousedownID!=-1) {  //Only stop if exists
      clearInterval(mousedownID);
      mousedownID=-1;
    }
  }
  function whilemousedown(e) {
    console.log("mouse down")
    if(right){
      $('#imageBar').animate({
            scrollLeft: $('#imageBar').scrollLeft()+50
        }, 10)
    }
    if(left){
      $('#imageBar').animate({
            scrollLeft: $('#imageBar').scrollLeft()-50
        }, 10)
    }
  }
//Assign events
document.addEventListener("mousedown", mousedown);
document.addEventListener("mouseup", mouseup);
//Also clear the interval when user leaves the window with mouse
document.addEventListener("mouseout", mouseup);

    document.getElementById("goRight").addEventListener('pointerover',(e)=>{
      right = true
    })
    document.getElementById("goRight").addEventListener('pointerleave',(e)=>{
      right = false
    })
    document.getElementById("goLeft").addEventListener('pointerover',(e)=>{
      left = true
    })
    document.getElementById("goLeft").addEventListener('pointerleave',(e)=>{
      left = false
    })*/

    document.getElementById("goRight").addEventListener('click',(e)=>{
        $('#imageBar').animate({
            scrollLeft: $('#imageBar').scrollLeft()+200
        }, 500)
    })

    document.getElementById("goLeft").addEventListener('click',(e)=>{
        $('#imageBar').animate({
            scrollLeft: $('#imageBar').scrollLeft()-200
        }, 500)
    }) 

    document.getElementById("closeInfoCard").addEventListener('click',()=>{
      iCard.style.visibility = "hidden"
    })

    function showLargeImage(image){
      // console.log("showing image",image.src)
      iCard.style.visibility = "visible"
      iImage.src = image.src
    }
  </script>
</html>